name: Cosmic Portfolio CI/CD

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: üöÄ Checkout –∫–æ–¥–∞
              uses: action/chekout@v4
            
            - name: ‚ö° –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
              uses: actions/setup-node@v3
              with:
                node-version: '18'

            - name: üîç –ê—É–¥–∏—Ç Lighthouse
              uses: treosh/lighthouse-ci-action@v9
              with:
                urls: |
                  https://HightWolt.github.io/portfolio-cosmos/
                temporaryPublicStorage: true
                confugPath: ./lighthouserc.json
              env:
                LIGHTHOUSE_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            
            - name: üì§ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
              uses: action/deploy-pages@v2
              id: deployment
              with:
                token: ${{ secrets.GITHUB_TOKEN }}
            
            - name: üìä –û—Ç–ø—Ä–∞–≤–∫–∞ Lighthouse-–æ—Ç—á—ë—Ç–∞
              if: success() && github.event_name == 'push'
              run: |
                echo "Lighthouse scores:"
                cat .lighthouseci/manifest.json | jq .
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    notify:
      needs: build-and-deploy
      runs-on: ubuntu-latest
      if: always()
      steps:
        - name: ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
          if: needs.build-and-deploy.result == 'success'
          run: echo "üöÄ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω! –°–∞–π—Ç –æ–±–Ω–æ–≤–ª—ë–Ω"
          
        - name: ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
          if: needs.build-and-deploy.result != 'success'
          run: echo "::error::üî• –î–µ–ø–ª–æ–π —É–ø–∞–ª! –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ workflow."
